<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ app_name }} – ED Wait Time Prediction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CSS CDN (simple, no build step) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Inter", "Segoe UI", sans-serif;
    }
  </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex items-center justify-center">
  <div class="w-full max-w-3xl mx-auto px-4 py-10">
    <!-- Card -->
    <div class="bg-slate-900/70 backdrop-blur-md rounded-2xl shadow-2xl border border-slate-800">
      <div class="px-8 pt-8 pb-4 border-b border-slate-800">
        <h1 class="text-2xl md:text-3xl font-semibold tracking-tight">
          ED Wait Time Prediction
        </h1>
        <p class="mt-2 text-sm text-slate-300">
          Enter hospital and time period details to estimate the
          <span class="font-semibold">Emergency Department wait time score</span>
          using your deployed ML model on Databricks.
        </p>
      </div>

      <!-- Form -->
      <div class="px-8 py-6">
        <form id="predict-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- State -->
          <div>
            <label class="block text-xs font-medium text-slate-300 mb-1" for="State">
              State
            </label>
            <input
              id="State"
              name="State"
              type="text"
              placeholder="e.g., AZ"
              class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400"
              required
            />
          </div>

          <!-- County/Parish -->
          <div>
            <label class="block text-xs font-medium text-slate-300 mb-1" for="CountyParish">
              County / Parish
            </label>
            <input
              id="CountyParish"
              name="County/Parish"
              type="text"
              placeholder="e.g., Maricopa"
              class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400"
              required
            />
          </div>

          <!-- Measure ID -->
          <div>
            <label class="block text-xs font-medium text-slate-300 mb-1" for="MeasureID">
              Measure ID
            </label>
            <input
              id="MeasureID"
              name="Measure ID"
              type="text"
              placeholder="e.g., ED_1"
              class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400"
              required
            />
          </div>

          <!-- Measure Name -->
          <div>
            <label class="block text-xs font-medium text-slate-300 mb-1" for="MeasureName">
              Measure Name
            </label>
            <input
              id="MeasureName"
              name="Measure Name"
              type="text"
              placeholder="e.g., ED Wait Time Score"
              class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400"
              required
            />
          </div>

          <!-- ZIP Code -->
          <div>
            <label class="block text-xs font-medium text-slate-300 mb-1" for="ZipCode">
              ZIP Code
            </label>
            <input
              id="ZipCode"
              name="ZIP Code"
              type="number"
              inputmode="numeric"
              placeholder="e.g., 85001"
              class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400"
              required
            />
          </div>

          <!-- Year -->
          <div>
            <label class="block text-xs font-medium text-slate-300 mb-1" for="Year">
              Year
            </label>
            <input
              id="Year"
              name="Year"
              type="number"
              inputmode="numeric"
              placeholder="e.g., 2024"
              class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400"
              required
            />
          </div>

          <!-- Month -->
          <div>
            <label class="block text-xs font-medium text-slate-300 mb-1" for="Month">
              Month
            </label>
            <input
              id="Month"
              name="Month"
              type="number"
              min="1"
              max="12"
              inputmode="numeric"
              placeholder="1–12"
              class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:border-emerald-400"
              required
            />
          </div>
        </form>

        <!-- Buttons -->
        <div class="mt-6 flex flex-col md:flex-row md:items-center gap-3">
          <button
            id="submit-btn"
            class="inline-flex items-center justify-center rounded-xl bg-emerald-500 hover:bg-emerald-400 text-slate-950 text-sm font-semibold px-4 py-2.5 shadow-lg shadow-emerald-500/40 transition-transform hover:-translate-y-0.5 disabled:opacity-50 disabled:hover:translate-y-0"
          >
            Predict ED Wait Time
          </button>

          <button
            id="reset-btn"
            class="inline-flex items-center justify-center rounded-xl border border-slate-700 text-slate-200 text-xs px-3 py-2 hover:bg-slate-800/80 transition"
          >
            Clear Form
          </button>

          <p id="status-text" class="text-xs text-slate-400 md:ml-auto">
            Model endpoint: <span class="font-mono text-[11px] text-emerald-300">/predict</span>
          </p>
        </div>

        <!-- Result -->
        <div id="result-card" class="mt-6 hidden">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/80 px-4 py-3">
            <p class="text-xs font-semibold tracking-wide text-slate-400 uppercase">
              Prediction
            </p>
            <p id="prediction-value" class="mt-1 text-2xl font-semibold text-emerald-300">
              <!-- Filled by JS -->
            </p>
            <p id="prediction-note" class="mt-1 text-xs text-slate-400">
              Model output representing the ED wait time score for the specified state, county, and period.
            </p>
          </div>
        </div>

        <!-- Error -->
        <div id="error-card" class="mt-4 hidden">
          <div class="rounded-2xl border border-red-500/40 bg-red-950/40 px-4 py-3">
            <p class="text-xs font-semibold tracking-wide text-red-300 uppercase">
              Error
            </p>
            <p id="error-message" class="mt-1 text-sm text-red-100"></p>
          </div>
        </div>
      </div>
    </div>

    <p class="mt-4 text-[11px] text-center text-slate-500">
      Powered by Databricks MLflow & Flask • Deployed on Render
    </p>
  </div>

  <!-- Simple inline JS to call /predict -->
  <script>
    const form = document.getElementById("predict-form");
    const submitBtn = document.getElementById("submit-btn");
    const resetBtn = document.getElementById("reset-btn");
    const resultCard = document.getElementById("result-card");
    const predictionValue = document.getElementById("prediction-value");
    const errorCard = document.getElementById("error-card");
    const errorMessage = document.getElementById("error-message");

    function setLoading(isLoading) {
      submitBtn.disabled = isLoading;
      submitBtn.textContent = isLoading ? "Predicting..." : "Predict ED Wait Time";
    }

    function clearMessages() {
      resultCard.classList.add("hidden");
      errorCard.classList.add("hidden");
      predictionValue.textContent = "";
      errorMessage.textContent = "";
    }

    resetBtn.addEventListener("click", (e) => {
      e.preventDefault();
      form.reset();
      clearMessages();
    });

    submitBtn.addEventListener("click", async (e) => {
      e.preventDefault();
      clearMessages();
      setLoading(true);

      // Build payload with exact keys expected by your backend
      const payload = {
        "State": document.getElementById("State").value.trim(),
        "County/Parish": document.getElementById("CountyParish").value.trim(),
        "Measure ID": document.getElementById("MeasureID").value.trim(),
        "Measure Name": document.getElementById("MeasureName").value.trim(),
        "ZIP Code": document.getElementById("ZipCode").value,
        "Year": document.getElementById("Year").value,
        "Month": document.getElementById("Month").value
      };

      try {
        const response = await fetch("/predict", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const data = await response.json();

        if (!response.ok || !data.success) {
          const err = data.error || "Prediction request failed.";
          errorMessage.textContent = err;
          errorCard.classList.remove("hidden");
        } else {
          predictionValue.textContent = data.prediction;
          resultCard.classList.remove("hidden");
        }
      } catch (err) {
        errorMessage.textContent = "Network error while calling /predict.";
        errorCard.classList.remove("hidden");
      } finally {
        setLoading(false);
      }
    });
  </script>
</body>
</html>
